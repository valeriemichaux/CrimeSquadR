---
title: "Datenauswertung"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(psych)
library(ggplot2)
library(fun)
library(colorspace)
library(Hmisc)
library(cowplot)

```

```{r}
datacleaning <- readr::read_csv("data/datacleaning.csv")

utilities<- readr::read_csv("data/Utilities.csv")

impo<- readr::read_csv2("data/Importances.csv")

importances.incl_SD<- readr::read_csv2("data/Importances_incl_SD.csv")

bind_cols(datacleaning, utilities, impo)-> new

new.short<-new[,c(-1, -9:-10, -22)]

#colnames(new.short)

names(new.short)[8:18]<- c("Konzert","Bahnhof","Einkaufsstraße","Bewegungsverlauf","Gesichtserkennung","Verdächtige Gegenstände", "KI liefert Erklärung", "KI liefert keine Erklärung", "Sofortige Löschung","Löschung nach 3 Monaten", "Dauerhafte Speicherung")

#Deskriptive Statistik 
mean(new.short$age)
min(new.short$age)
max(new.short$age)
sd(new.short$age)

new.short %>%
  ggplot(aes(x = age)) + geom_histogram()

#new.short%>% 
  #mutate(gender = case_when(
    #gender == "maennlich" ~ 1,
    #gender == "weiblich" ~ 2)) ->new.short

#table(new.short$gender)
#wir haben 41 Männer und 55 Frauen 

  
#T-Test: Welcher Geschlechtsunterschiede und Trade-Offs gibt es bei der Akzeptanzbewertung von KI-basierter Videoüberwachung?

#UV: Geschelcht; Gruppen: Männlich& weiblich, AV: Speicherung


#Code Bsp. t-Test

t.test(filter (new.short, gender == "maennlich")$KUT, filter(new.short, gender == "weiblich")$KUT)

t.test(filter (new.short, gender == "maennlich")$Speicherung, filter(new.short, gender == "weiblich")$Speicherung)

#Es gibt keinen signifikanten Unterschied zwischen Männern und Frauen hinsichtlich der Akzeptanz von Datenspeicherung bei KI-basierter Videoüberwachung (t(78.67)= -0.34897, p=.728). 

t.test(filter (new.short, gender == "maennlich")$Datenpartikel, filter(new.short, gender == "weiblich")$Datenpartikel)
#Es gibt keinen signifikanten Unterschied zwischen Männern und Frauen hinsichtlich ihrer Akzeptanz der Art der gesammelten Daten bei KI-basierter Videoüberwachung (t(75.81)= 0.07796, p=.9381).

t.test(filter (new.short, gender == "maennlich")$Ort, filter(new.short, gender == "weiblich")$Ort)
#Es gibt keinen signifikanten Unterschied zwischen Männern und Frauen hinsichtlich ihrer Akzeptanz des Ortes bei KI-basierter Videoüberwachung (t(93.95)= -1.3207, p=.1898).

t.test(filter (new.short, gender == "maennlich")$Erklärbarkeit, filter(new.short, gender == "weiblich")$Erklärbarkeit)
#Es gibt keinen signifikanten Unterschied zwischen Männern und Frauen hinsichtlich der Akzeptanz von Erklärbarkeit bei KI-basierter Videoüberwachung (t(90.97)= 1.4364, p=.1543).


mean(new.short$Ort)

```
```{r}
#Visualisierung Relative Wichtigkeit der Merkmale

importances.incl_SD %>%
  ggplot(aes(x = Total, y = fct_reorder(Attribute, Total))) + geom_col(fill = "lightblue") + geom_errorbarh(aes(xmin = Lower, xmax = Upper)) +
  scale_x_continuous(limits = c(0, 50), breaks = c(0, 10, 20, 30, 40, 50), expand = c(0.02,0.02)) +
  scale_y_discrete(expand = c(0,0)) +
  labs(x = "Relative Wichtigkeit der Merkmale (%)", y = "", title = "Das Merkmal Datenspeicherung ist am wichtigsten hinlänglich\n der Akzeptanz ki-basierter Videoüberwachungssysteme", subtitle = "") +
  theme_minimal_vgrid(12) -> plot_Importances_General

```

```{r}
#Importances (nach Geschelchtern) visualisieren 



```




```{r}
#partworth utilities visualisieren 

pwu<- new.short%>% select("Konzert", "Bahnhof","Einkaufsstraße","Bewegungsverlauf","Gesichtserkennung","Verdächtige Gegenstände", "KI liefert Erklärung", "KI liefert keine Erklärung", "Sofortige Löschung", "Löschung nach 3 Monaten", "Dauerhafte Speicherung")%>%  pivot_longer(cols = everything(), names_to="pwu", values_to="score")


# Dieser Datensatz hat nun 1056 Zeilen wegen 11 (pwus)x 96 Probanden 
colnames(new.short)

pwu$pwu <- factor(
  pwu$pwu,
  levels = c
  (
    "Konzert",
    "Bahnhof",
    "Einkaufsstraße",
    "Bewegungsverlauf",
    "Gesichtserkennung",
    "Verdächtige Gegenstände",
    "KI liefert Erklärung",
    "KI liefert keine Erklärung",
    "Sofortige Löschung",
    "Löschung nach 3 Monaten",
    "Dauerhafte Speicherung"
  )
)


pwu%>%
  ggplot+
  aes(x=pwu, y=score)+
   stat_summary(geom = "bar", position = position_dodge(), color="#B0BAC3", fill="#B0BAC3") +
  stat_summary(fun.y = mean, geom = "point", size=0.8)+
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width=0.5, size=0.4, alpha=0.5) +
 #stat_summary(geom="text", aes(label=sprintf("%1.2f%%", ..y..)), size=3, position) +
  coord_flip()+
  #ylim(-100,100) +
   scale_y_continuous(limits = c(-100, 100), breaks = c(-100,-50,0,50,100)) +
  labs(x="Level", y="Teilnutzenwerte")+
  scale_x_discrete(label=c("Konzert","Bahnhof","Einkaufsstraße","Bewegungsverlauf","Gesichtserkennung","Verdächtige Gegenstände", "KI liefert Erklärung", "KI liefert keine Erklärung", "Sofortige Löschung", "Löschung nach 3 Monaten", "Dauerhafte Speicherung"))+
theme_classic()

#erstes Grüst, allerdings müsssen die Skalenbeschriftungen noch angepasst werden 
                                    
```

