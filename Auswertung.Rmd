---
title: "Datenauswertung"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(psych)
library(ggplot2)
library(fun)
library(colorspace)
library(Hmisc)
library(cowplot)
library(svglite)
library(extrafont)
library(dplyr)





```

```{r}
datacleaning <- readr::read_csv("data/datacleaning.csv")

utilities<- readr::read_csv("data/Utilities.csv")

impo<- readr::read_csv2("data/Importances.csv")

importances.incl_SD<- readr::read_csv2("data/Importances_incl_SD.csv")

importances.longer<- readr::read_csv2("data/Importanes_geschlecht_longer.csv")

bind_cols(datacleaning, utilities, impo)-> new

new.short<-new[,c(-1, -9:-10, -22)]

#colnames(new.short)

names(new.short)[8:18]<- c("Konzert","Bahnhof","Einkaufsstraße","Bewegungsverlauf","Gesichtserkennung","Verdächtige Gegenstände", "KI liefert Erklärung", "KI liefert keine Erklärung", "Sofortige Löschung","Löschung nach 3 Monaten", "Dauerhafte Speicherung")

#Deskriptive Statistik 
mean(new.short$age)
min(new.short$age)
max(new.short$age)
sd(new.short$age)
median(new.short$age)

new.short %>%
  ggplot(aes(x = age)) + geom_histogram()

#new.short%>% 
  #mutate(gender = case_when(
    #gender == "maennlich" ~ 1,
    #gender == "weiblich" ~ 2)) ->new.short

#table(new.short$gender)
#wir haben 41 Männer und 55 Frauen 

  
#T-Test: Welcher Geschlechtsunterschiede und Trade-Offs gibt es bei der Akzeptanzbewertung von KI-basierter Videoüberwachung?

#UV: Geschelcht; Gruppen: Männlich& weiblich, AV: Speicherung


#Berechnung t-test

t.test(filter (new.short, gender == "maennlich")$KUT, filter(new.short, gender == "weiblich")$KUT)

t.test(filter (new.short, gender == "maennlich")$Speicherung, filter(new.short, gender == "weiblich")$Speicherung)

#Es gibt keinen signifikanten Unterschied zwischen Männern und Frauen hinsichtlich der Akzeptanz von Datenspeicherung bei KI-basierter Videoüberwachung (t(78.67)= -0.34897, p=.728). 

t.test(filter (new.short, gender == "maennlich")$Datenpartikel, filter(new.short, gender == "weiblich")$Datenpartikel)
#Es gibt keinen signifikanten Unterschied zwischen Männern und Frauen hinsichtlich ihrer Akzeptanz der Art der gesammelten Daten bei KI-basierter Videoüberwachung (t(75.81)= 0.07796, p=.9381).

t.test(filter (new.short, gender == "maennlich")$Ort, filter(new.short, gender == "weiblich")$Ort)
#Es gibt keinen signifikanten Unterschied zwischen Männern und Frauen hinsichtlich ihrer Akzeptanz des Ortes bei KI-basierter Videoüberwachung (t(93.95)= -1.3207, p=.1898).

t.test(filter (new.short, gender == "maennlich")$Erklärbarkeit, filter(new.short, gender == "weiblich")$Erklärbarkeit)
#Es gibt keinen signifikanten Unterschied zwischen Männern und Frauen hinsichtlich der Akzeptanz von Erklärbarkeit bei KI-basierter Videoüberwachung (t(90.97)= 1.4364, p=.1543).


mean(new.short$Ort)

```

```{r}
#Visualisierung Relative Wichtigkeit der Merkmale

importances.incl_SD %>%
  ggplot(aes(x = Total, y = fct_reorder(Attribute, Total))) + geom_col(fill = "lightblue") + geom_errorbar(aes(xmin = Total - SD, xmax = Total + SD), width = 0.2) +
  scale_x_continuous(limits = c(0, 50), breaks = c(0, 10, 20, 30, 40, 50), expand = c(0.02,0.02)) +
  scale_y_discrete(expand = c(0,0)) +
  labs(x = "Relative Wichtigkeit der Merkmale (%)", y = "", title = "Das Merkmal Datenspeicherung ist am wichtigsten hinlänglich\nder Akzeptanz ki-basierter Videoüberwachungssysteme", subtitle = "") +
  theme_minimal_vgrid(12) -> plot_Importances_General


plot_Importances_General
```

```{r}
#Importances (nach Geschelchtern) visualisieren 

importances.longer %>%
  ggplot(aes(x = score, y = fct_reorder(Attribute, score), fill = gender)) + geom_col(position = "dodge") + 
  geom_errorbar(aes(xmin = score - SD, xmax = score + SD), position= position_dodge(0.9), width = 0.2) +
  scale_x_continuous(limits = c(0, 50), breaks = c(0, 10, 20, 30, 40, 50), expand = c(0.02,0.02)) +
  scale_y_discrete(expand = c(0,0)) +
  labs(x = "Relative Wichtigkeit der Merkmale (%)", y = "", title = "Es gibt keine signifikanten Unterschiede bei der Bewertung\nder Merkmale in Bezug auf das Geschlecht ", subtitle = "") +
  scale_fill_discrete(name = "", labels = c("männlich", "weiblich")) +
  theme_minimal_vgrid(12) -> plot_Importances_gender

plot_Importances_gender



```




```{r}
#partworth utilities visualisieren 

pwu<- new.short%>% select("Konzert", "Bahnhof","Einkaufsstraße","Bewegungsverlauf","Gesichtserkennung","Verdächtige Gegenstände", "KI liefert Erklärung", "KI liefert keine Erklärung", "Sofortige Löschung", "Löschung nach 3 Monaten", "Dauerhafte Speicherung")%>%  pivot_longer(cols = everything(), names_to="pwu", values_to="score")


# Dieser Datensatz hat nun 1056 Zeilen wegen 11 (pwus)x 96 Probanden 

#Attribute im Df ergänzen 
pwu%>% 
  mutate(Attribut = case_when(
  pwu == "Bahnhof" ~ "Ort", 
  pwu == "Konzert" ~ "Ort", 
  pwu == "Einkaufsstraße"~ "Ort", 
  pwu == "Bewegungsverlauf" ~ "Datenpartikel",
  pwu == "Gesichtserkennung" ~ "Datenpartikel",
  pwu == "Verdächtige Gegenstände" ~ "Datenpartikel",
  pwu == "KI liefert Erklärung"~ "Erklärbarkeit",
  pwu == "KI liefert keine Erklärung"~ "Erklärbarkeit",
  pwu == "Sofortige Löschung" ~ "Datenspeicherung", 
  pwu == "Löschung nach 3 Monaten"~ "Datenspeicherung",
  pwu == "Dauerhafte Speicherung" ~ "Datenspeicherung"))-> pwu


#colnames(new.short)

#Level ordnen 
pwu$pwu <- factor(
  pwu$pwu,
  levels = c
  ("Konzert",
    "Bahnhof",
    "Einkaufsstraße",
    "Bewegungsverlauf",
    "Gesichtserkennung",
    "Verdächtige Gegenstände",
    "KI liefert Erklärung",
    "KI liefert keine Erklärung",
    "Sofortige Löschung",
    "Löschung nach 3 Monaten",
    "Dauerhafte Speicherung"
  )
)


# Attribute ordnen 
pwu$Attribut<- factor(pwu$Attribut, levels= c ("Datenspeicherung", "Erklärbarkeit", "Datenpartikel", "Ort"))

pwu%>%
  ggplot +
  aes(x=pwu, y=score, fill = Attribut)+
   stat_summary(geom = "bar", position = position_dodge()) +
   #stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width=0.5, size=0.4, alpha=0.5) +
    coord_flip()+
  stat_summary(geom="text", aes(label=sprintf("%1.2f%%", ..y..)), size=3, position= position_dodge(width = 0.09)) +
  labs(x="", y="Teilnutzenwerte der Merkmale", fill= "Attribute")+
  scale_fill_manual( values = c ("#adf7b6", "#ffc09f", "#ffee93","#a0ced9"))+
  scale_x_discrete(label=c("Konzert","Bahnhof","Einkaufsstraße","Bewegungsverlauf","Gesichtserkennung","Verdächtige Gegenstände", "KI liefert Erklärung", "KI liefert keine Erklärung", "Sofortige Löschung", "Löschung nach 3 Monaten", "Dauerhafte Speicherung"))+  
  geom_vline(xintercept = 3.52, linetype= "dashed", color= "#D4D4D4")+
   geom_vline(xintercept = 6.52, linetype= "dashed", color= "#D4D4D4")+
   geom_vline(xintercept = 8.53, linetype= "dashed", color= "#D4D4D4")+
theme_minimal_vgrid()



# Roberts Plot 
pwu%>%
  ggplot+
  aes(x=pwu, y=score, fill = pwu)+
   stat_summary(geom = "bar", position = position_dodge(), stat = "identity") +
   scale_fill_manual(values = c("Dauerhafte Speicherung" = "#adf7b6", "Löschung nach 3 Monaten" = "#adf7b6", "Sofortige Löschung" = "#adf7b6",
                                "KI liefert keine Erklärung" = "#ffc09f", "KI liefert Erklärung" = "#ffc09f",
                                "Verdächtige Gegenstände" = "#a0ced9", "Gesichtserkennung" = "#a0ced9", "Bewegungsverlauf" = "#a0ced9",
                                "Einkaufsstraße" = "#ffee93", "Bahnhof" = "#ffee93", "Konzert" = "#ffee93")) +
 stat_summary(fun.data = mean_cl_normal, geom = "errorbar", width=0.5, size=0.4, alpha=0.5) +
  coord_flip()+
  stat_summary(geom="text", aes(label=sprintf("%1.2f%%", ..y..)), size=3, position= position_dodge(width = 0.09)) +
  labs(x="", y="Teilnutzenwerte der Merkmale")+
  scale_x_discrete(label=c("Konzert","Bahnhof","Einkaufsstraße","Bewegungsverlauf","Gesichtserkennung","Verdächtige Gegenstände", "KI liefert Erklärung", "KI liefert keine Erklärung", "Sofortige Löschung", "Löschung nach 3 Monaten", "Dauerhafte Speicherung"))+
  #ylim(-250,100)+
theme_minimal_vgrid() +
guides(fill=guide_legend("Merkmale"))


ggsave('data/pwu5.png', width = 20, height = 10, units = "cm", dpi=300)

 
 
 
 #Back-Up
 # scale_y_continuous(limits= c(-200,200), breaks=c(-100,-50,0,50,100), labels = c("-100", "-50", "0","50", "100"), expand =     c(0,00000001,0,00000001))
  #ylim(-250,100)+
  #stat_summary(fun.y = mean, geom = "point", size=0.2)+
  #stat_summary(geom="text", aes(label=sprintf("%1.2f%%", ..y..)), size=3, position= position_dodge(width = 0.09)) +
 
                                    
```

